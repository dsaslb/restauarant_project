#!/usr/bin/env python3
# -*- coding: utf-8 -*-

def fix_strings():
    """app.py 파일의 깨진 문자열을 수정"""
    
    try:
        # 파일 읽기
        with open('app.py', 'r', encoding='utf-8') as f:
            content = f.read()
        
        # 수정할 문자열들 (깨진 한글 → 정상 한글)
        replacements = [
            # 로그인/권한 관련
            ("'로그?이 ?요?니??'", "'로그인이 필요합니다.'"),
            ("'관리자 권한???요?니??'", "'관리자 권한이 필요합니다.'"),
            ("'권한???니??'", "'권한이 없습니다.'"),
            
            # 사유/템플릿 관련
            ("'?유가 ?데?트?었?니??'", "'사유가 업데이트되었습니다.'"),
            ("'?? 존재?는 ?플릿입?다.'", "'이미 존재하는 템플릿입니다.'"),
            ("'?유 ?스?? ?력?주?요.'", "'사유 텍스트를 입력해주세요.'"),
            
            # 알림 관련
            ("'처리???림???택?주?요.'", "'처리할 알림을 선택해주세요.'"),
            ("'모든 ?림? 읽음 처리?었?니??'", "'모든 알림을 읽음 처리했습니다.'"),
            
            # 근태/통계 관련
            ("'근태 기록??찾을 ???습?다.'", "'근태 기록을 찾을 수 없습니다.'"),
            ("'본인???계?조회?????습?다.'", "'본인 통계만 조회할 수 있습니다.'"),
            ("'본인??근태?조회?????습?다.'", "'본인 근태만 조회할 수 있습니다.'"),
            ("'본인??근태??운로드?????습?다.'", "'본인 근태만 다운로드할 수 있습니다.'"),
            
            # 지각 관련 깨진 문자열들
            ("'지? in r.status", "'지각' in r.status"),
            ("'지?: h.late,", "'지각': h.late,"),
            ("'지?: late,", "'지각': late,"),
            ("'지?: 'O' if r.is_late else '',", "'지각': 'O' if r.is_late else '',"),
            ("\"지?: late,", "\"지각\": late,"),
            
            # 기타 깨진 문자열들
            ("r.status == '\\?\\?상'", "r.status == '정상'"),
            ("swap_count = {'\\?\\?\\?: 0, '\\?\\?\\?': 0, '거절': 0}", "swap_count = {'대기': 0, '승인': 0, '거절': 0}"),
            ("category='교\\?\\?', status='\\?\\?\\?)", "category='교대', status='대기')"),
        ]
        
        # 문자열 교체
        modified = False
        for old, new in replacements:
            if old in content:
                content = content.replace(old, new)
                print(f"✅ 수정됨: {old} -> {new}")
                modified = True
            else:
                print(f"ℹ️ 찾을 수 없음: {old}")
        
        if not modified:
            print("ℹ️ 수정할 내용이 없습니다.")
            return True
        
        # 파일 저장
        with open('app.py', 'w', encoding='utf-8') as f:
            f.write(content)
        
        print("✅ 문자열 수정 완료!")
        return True
        
    except Exception as e:
        print(f"❌ 오류 발생: {e}")
        return False

if __name__ == "__main__":
    print("🚀 문자열 수정 시작...")
    success = fix_strings()
    
    if success:
        print("✅ 모든 수정이 완료되었습니다!")
    else:
        print("❌ 수정에 실패했습니다.")

# fix_strings.py 예시
broken_to_fixed = {
    "로그?이 ?요?니??": "로그인이 필요합니다.",
    "관리자 권한???요?니??": "관리자 권한이 필요합니다.",
    "권한???니??": "권한이 없습니다.",
    "사유가 ?데?트?었?니??": "사유가 업데이트되었습니다.",
    "이미 존재?는 ?플릿입?다.": "이미 존재하는 템플릿입니다.",
    "사유 ?스?? ?력?주?요.": "사유 텍스트를 입력해주세요.",
    "처리???림???택?주?요.": "처리할 알림을 선택해주세요.",
    "모든 ?림? 읽음 처리?었?니??": "모든 알림을 읽음 처리했습니다.",
    "근태 기록??찾을 ???습?다.": "근태 기록을 찾을 수 없습니다.",
    "본인???계?조회?????습?다.": "본인 통계만 조회할 수 있습니다.",
    "본인??근태?조회?????습?다.": "본인 근태만 조회할 수 있습니다.",
    "본인??근태??운로드?????습?다.": "본인 근태만 다운로드할 수 있습니다.",
    "지? in r.status": "지각' in r.status",
    "지?: h.late,": "지각': h.late,",
    "지?: late,": "지각': late,",
    "지?: 'O' if r.is_late else '',": "지각': 'O' if r.is_late else '',",
    "\"지?: late,": "\"지각\": late,",
    "r.status == '\\?\\?상'": "r.status == '정상'",
    "swap_count = {'\\?\\?\\?: 0, '\\?\\?\\?': 0, '거절': 0}": "swap_count = {'대기': 0, '승인': 0, '거절': 0}",
    "category='교\\?\\?', status='\\?\\?\\?)": "category='교대', status='대기')",
} 