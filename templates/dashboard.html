<!DOCTYPE html>
<html>
<head>
    <title>대시보드 - Core System</title>
    <meta charset="utf-8">
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .header { background-color: #333; color: white; padding: 15px; margin-bottom: 20px; }
        .nav { background-color: #4CAF50; padding: 10px; margin-bottom: 20px; }
        .nav a { color: white; text-decoration: none; margin-right: 20px; padding: 8px 16px; border-radius: 5px; }
        .nav a:hover { background-color: rgba(255,255,255,0.2); }
        .container { max-width: 1200px; margin: 0 auto; }
        .notice-list { list-style-type: none; padding: 0; }
        .notice-item { background-color: #f9f9f9; margin: 10px 0; padding: 15px; border-radius: 5px; }
        .logout-btn { background-color: #f44336; color: white; padding: 8px 16px; text-decoration: none; border-radius: 5px; }
        .admin-menu { background-color: #ff9800; }
        .user-info { margin-bottom: 20px; }
    </style>
</head>
<body>
    <div class="header">
        <h1>{{ user.username }} 님 대시보드</h1>
        <a href="/logout" class="logout-btn">로그아웃</a>
    </div>
    
    <div class="user-info">
        <h2>👤 사용자 정보</h2>
        <p><strong>역할:</strong> {{ user.role|title }} | <strong>직급:</strong> {{ user.grade|title }}</p>
        <p><strong>상태:</strong> 
            {% if user.status == 'approved' %}✅ 승인됨
            {% elif user.status == 'pending' %}⏳ 승인 대기
            {% else %}❌ 거절됨{% endif %}
        </p>
    </div>
    
    <div class="nav">
        {% set perms = user.get_permissions() %}
        
        <!-- 기본 권한 메뉴 -->
        {% if perms.get('order', False) or user.role == 'admin' %}
            <a href="/order">📦 발주 관리</a>
        {% endif %}
        {% if perms.get('schedule', False) or user.role == 'admin' %}
            <a href="/schedule">👥 스케줄 관리</a>
        {% endif %}
        {% if perms.get('clean', False) or user.role == 'admin' %}
            <a href="/clean">🧹 청소 관리</a>
        {% endif %}
        
        <!-- 확장 권한 메뉴 -->
        {% if perms.get('inventory', False) or user.role == 'admin' %}
            <a href="/inventory">📦 재고 관리</a>
        {% endif %}
        {% if perms.get('reservation', False) or user.role == 'admin' %}
            <a href="/reservation">📅 예약 관리</a>
        {% endif %}
        {% if perms.get('accounting', False) or user.role == 'admin' %}
            <a href="/accounting">💰 정산 관리</a>
        {% endif %}
        {% if perms.get('customer', False) or user.role == 'admin' %}
            <a href="/customer">👥 고객 관리</a>
        {% endif %}
        {% if perms.get('reports', False) or user.role == 'admin' %}
            <a href="/reports">📊 보고서</a>
        {% endif %}
        
        <!-- 공통 메뉴 -->
        <a href="/change_password">🔐 비밀번호 변경</a>
        <a href="/notifications">🔔 알림</a>
        
        <!-- 관리자 전용 메뉴 -->
        {% if user.role == 'admin' %}
            <a href="/admin/approve_users" class="admin-menu">✅ 가입 승인 관리</a>
            <a href="/admin/user_permissions" class="admin-menu">🔧 직원 권한 관리</a>
            <a href="/admin/approval_logs" class="admin-menu">📋 권한 변경 이력</a>
        {% endif %}
    </div>
    
    <div class="container">
        <h3>📢 운영 방침/공지</h3>
        <ul class="notice-list">
            {% for n in notices %}
                <li class="notice-item">
                    {{ n.content }} 
                    <small style="color: #666;">({{ n.created_at.strftime('%Y-%m-%d') }})</small>
                </li>
            {% endfor %}
        </ul>
    </div>
</body>
</html> 